# 2026-02-14 - D19 | æ•´æ•°ç²¾åº¦ / èˆå…¥ï¼šVault share è®¡ç®—ä¸ Fee èˆå…¥å¯¼è‡´çš„å¯åˆ©ç”¨è¡Œä¸ºï¼ˆå«è¾¹ç•Œæµ‹è¯•ä¸å®¡è®¡è§†è§’ï¼‰

tags: [solidity, foundry, defi, vault, erc4626, rounding, precision, fee, security, audit]

> ä»Šæ—¥ç›®æ ‡ï¼šç”¨**å¯è¿è¡Œçš„æœ€å°å¤ç°**ç†è§£å¹¶è¦†ç›–ä¸¤ç±»é«˜é¢‘ç»æµæ¼æ´é¢ï¼š  
> 1) **Vault / share å…‘æ¢ç‡**ä¸­çš„æ•´æ•°é™¤æ³•èˆå…¥ï¼ˆfloor/ceilï¼‰ä¸ donationï¼ˆç›´æ¥è½¬è´¦ï¼‰å¼•å‘çš„è¾¹ç•Œä¸å¯åˆ©ç”¨è¡Œä¸º  
> 2) **æ‰‹ç»­è´¹ï¼ˆbpsï¼‰**æŒ‰æ•´æ•°é™¤æ³•å‘ä¸‹å–æ•´å¯¼è‡´çš„â€œåˆ†æ‹†ç»•è´¹ / å°‘ä»˜è´¹â€é—®é¢˜  
> åŒæ—¶æŠŠä½ ä»Šå¤©é—®åˆ°çš„å…³é”®é—®é¢˜ï¼ˆwhy / howï¼‰æ•´ç†æˆå¯å¤ä¹ çš„ Q&Aã€‚

---

## 0. èƒŒæ™¯ï¼šæ•´æ•°é™¤æ³•åªæœ‰ floorï¼ˆå‘ä¸‹å–æ•´ï¼‰

Solidity çš„ `x / y`ï¼ˆx,y ä¸ºæ•´æ•°ï¼‰å¤©ç„¶æ˜¯ **floor**ï¼šä¸¢æ‰å°æ•°éƒ¨åˆ†ã€‚

- **floor**ï¼š`101 / 100 = 1`
- **ceilï¼ˆå‘ä¸Šå–æ•´ï¼‰**å¸¸ç”¨å…¬å¼ï¼š`ceilDiv(x, y) = (x + y - 1) / y`

---

## 1. Vault æ˜¯ä»€ä¹ˆï¼Ÿshares / totalShares / totalAssets ä¸‰ä¸ªé‡çš„å«ä¹‰

æŠŠ Vault æƒ³æˆâ€œåŸºé‡‘â€ï¼š

- `assets`ï¼šä½ æœ¬æ¬¡å­˜å…¥/æ¢ç®—çš„**åº•å±‚èµ„äº§æ•°é‡**ï¼ˆERC20 æœ€å°å•ä½ï¼‰
- `totalShares`ï¼ˆå¸¸è®°ä¸º `ts`ï¼‰ï¼šVault å·²å‘è¡Œåœ¨å¤–çš„**ä»½é¢æ€»é‡**ï¼ˆshares ä¹Ÿæ˜¯ ERC20ï¼‰
- `totalAssets`ï¼ˆå¸¸è®°ä¸º `ta`ï¼‰ï¼šVault ç®¡ç†çš„**åº•å±‚èµ„äº§æ€»é‡**ï¼ˆå¸¸è§å®ç°ä¸º `asset.balanceOf(address(this))`ï¼Œä¹Ÿå¯èƒ½å«ç­–ç•¥å‡€å€¼ï¼‰

å¸¸è§æ¢ç®—ï¼ˆdeposit è®¡ç®— sharesï¼‰ï¼š

\[
shares = \left\lfloor \frac{assets \cdot totalShares}{totalAssets} \right\rfloor
\]

ç›´è§‰ï¼šä½ å­˜å…¥èµ„äº§å æ± å­èµ„äº§çš„æ¯”ä¾‹ Ã— ä»½é¢æ€»é‡ = ä½ åº”å¾—çš„ä»½é¢ã€‚

---

## 2. ä¸ºä»€ä¹ˆåˆå§‹åŒ–è¦ç”¨ `if (ts==0 || ta==0)`ï¼ˆä¸ºä»€ä¹ˆæ˜¯â€œæˆ–â€ï¼‰

å…¸å‹ deposit ç»“æ„ï¼š

```solidity
uint256 ts = totalSupply();
uint256 ta = totalAssets();

if (ts == 0 || ta == 0) {
    shares = assets; // 1:1 åˆå§‹åŒ–
} else {
    shares = (assets * ts) / ta; // floor
}
```

ä¸ºä»€ä¹ˆç”¨ `||`ï¼š

- `ta == 0`ï¼šä¼šå‡ºç° **é™¤ä»¥ 0**ï¼ˆç›´æ¥ revertï¼‰
- `ts == 0`ï¼šä¼šå‡ºç° `shares = assets * 0 / ta = 0`ï¼ˆé¦–å­˜æ‹¿ä¸åˆ°ä»½é¢ï¼‰

å¦‚æœå†™æˆ `&&`ï¼Œä¼šæ¼æ‰ä¸€ç§éå¸¸çœŸå®çš„è¾¹ç•Œï¼š  
**ts==0 ä½† ta>0**ï¼ˆä¾‹å¦‚æœ‰äººç›´æ¥ç»™ Vault è½¬å…¥èµ„äº§ donationï¼‰ï¼Œå¯¼è‡´é¦–å­˜è€…ç®—å‡º `shares=0` æˆ–è¢« `require` æ‹¦ä½ â†’ é¦–å­˜ DoSã€‚

---

## 3. donation ç°å®ä¸­æ˜¯å¦å­˜åœ¨ï¼Ÿ

**å­˜åœ¨ï¼Œè€Œä¸”ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦ `donate()` å‡½æ•°ï¼š**

- ä»»ä½•äººéƒ½å¯ä»¥ç›´æ¥ `asset.transfer(vault, amount)` æŠŠ ERC20 æ‰“è¿› Vault åœ°å€  
- è¿™ä¼šè®© `totalAssets` å˜å¤§ï¼Œä½†ä¸ä¼šè‡ªåŠ¨ mint sharesï¼ˆå› ä¸ºæ²¡èµ° depositï¼‰  
- ç»æµæ•ˆæœç­‰åŒäº donationï¼š**ta â†‘ï¼Œts ä¸å˜ï¼Œshare ä»·æ ¼ ta/ts â†‘**

ä¸€äº›é¡¹ç›®ä¹Ÿä¼šæ˜¾å¼æä¾› `donate()/skim()/sync()/harvest()` ç­‰ï¼Œä½†å³ä½¿æ²¡æœ‰ï¼Œ**ç›´æ¥è½¬è´¦ä¹Ÿæ°¸è¿œå­˜åœ¨**ã€‚

---

## 4. `asset.transferFrom(msg.sender, address(this), assets)` ä¸ºä»€ä¹ˆè¦â€œé€šè¿‡ USDC åˆçº¦â€è½¬ï¼Ÿ

å› ä¸º ERC20 çš„ä½™é¢è®°åœ¨ **ERC20 åˆçº¦çš„è´¦æœ¬é‡Œ**ï¼š`balanceOf[address]`ã€‚  
è½¬è´¦å¿…é¡»è°ƒç”¨ä»£å¸åˆçº¦å‡½æ•°ï¼ˆ`transfer/transferFrom`ï¼‰æ¥æ”¹è´¦æœ¬ã€‚

- `address(this)`ï¼šå½“å‰æ‰§è¡Œåˆçº¦ï¼ˆè¿™é‡Œæ˜¯ Vaultï¼‰çš„åœ°å€ï¼Œä¸æ˜¯ `asset`  
- `transferFrom(from,to,amount)`ï¼šä» `from` æ‰£æ¬¾åˆ° `to`ï¼Œéœ€è¦ `from` äº‹å…ˆ `approve(msg.sender, amount)`

> å¯¹æ¯”ï¼šETH æ˜¯åè®®å±‚ä½™é¢ï¼›ERC20 æ˜¯åˆçº¦å±‚ä½™é¢ã€‚

---

## 5. `_mint(receiver, shares)` æ˜¯å¦æ›´æ–°äº†æ€» shares / ä½™é¢ï¼Ÿä¸ºä»€ä¹ˆ deposit é‡Œæ²¡æ‰‹å†™æ›´æ–°ï¼Ÿ

æ˜¯çš„ï¼Œ`_mint` å†…éƒ¨ä¼šæ›´æ–°ï¼š

- `totalSupply += shares`
- `balanceOf[receiver] += shares`
- `emit Transfer(0, receiver, shares)`

ä½ åœ¨ deposit é‡Œå†™çš„ `ts` æ˜¯ä¸€ä¸ª**å¿«ç…§å±€éƒ¨å˜é‡**ç”¨äºè®¡ç®—ï¼Œä¸æ˜¯å…¨å±€çŠ¶æ€ã€‚

---

## 6. ä¸ºä»€ä¹ˆæµ‹è¯•é‡Œç”¨ `1 wei` è€Œä¸æ˜¯ `1 ether`ï¼Ÿ

æœ¬è´¨æ˜¯åš **dustï¼ˆæå°é¢ï¼‰è¾¹ç•Œæµ‹è¯•**ï¼š  
è¦è§¦å‘ `floor` å¸¦æ¥çš„ â€œshares å˜ 0 / +1 è¯¯å·®â€ ç­‰æ•ˆæœï¼Œè¾“å…¥å¿…é¡»è¶³å¤Ÿå°ã€‚

- `1 ether = 10^18 wei`
- `1 wei = 1`ï¼ˆæœ€å°å•ä½ï¼‰

åœ¨ 18 decimals çš„ MockERC20 ä¸‹ï¼Œç”¨ `1 wei` æœ€å®¹æ˜“è¸©åˆ°ä¸´ç•Œç‚¹ã€‚  
è‹¥ä½ æ¨¡æ‹Ÿçš„æ˜¯ USDCï¼ˆ6 decimalsï¼‰ï¼Œåº”æŠŠâ€œæœ€å°å•ä½â€ç†è§£ä¸º `1`ï¼ˆ= 0.000001 USDCï¼‰ï¼Œè€Œä¸æ˜¯ `wei/ether` è¯­æ³•ç³–ã€‚

---

## 7. å…¸å‹åå®ç°ï¼šdeposit floor + redeem ceilï¼ˆä¸ä¸€è‡´èˆå…¥ï¼‰

ä¸€ä¸ªä¼šè¢«å®¡è®¡ç‰¹åˆ«å…³æ³¨çš„ç»„åˆï¼š

- depositï¼š`shares = floor(assets * ts / ta)`
- redeemï¼š`assets = ceil(shares * ta / ts)`

å…¶ä¸­ redeem çš„ ceil å¸¸å†™æˆï¼š

```solidity
assets = (shares * ta + ts - 1) / ts; // ceil
```

**é£é™©**ï¼šceil ä¼šâ€œå®å¯å¤šç»™ 1 ä¸ªæœ€å°å•ä½â€ï¼Œå¦‚æœå¯å¾ªç¯/å¯æ‰¹é‡ï¼Œå°±å¯èƒ½è¢«æŒ¤ç‰™è†æ”¾å¤§ã€‚

---

## 8. ä½ é‡åˆ°çš„æŠ¥é”™ï¼š`zero shares` çš„çœŸå®åŸå› ï¼ˆæŒ‰ trace æ•°æ®æ¨å¯¼ï¼‰

ä½ çœŸå® traceï¼ˆç²¾ç®€ï¼‰ï¼š

- Alice deposit `1000 ether` â†’ `ts = 1000e18`, `ta = 1000e18`
- attacker donate `1` â†’ `ta = 1000e18 + 1`, `ts = 1000e18`
- attacker deposit `1` â†’ è®¡ç®—

\[
shares = \left\lfloor \frac{1 \cdot 1000e18}{1000e18+1} \right\rfloor < 1 \Rightarrow shares=0
\]

äºæ˜¯è§¦å‘ `require(shares > 0, "zero shares")`ã€‚

**æœ€å°å¯å­˜å…¥ assetsï¼ˆé¿å… shares=0ï¼‰**ï¼š

\[
minAssets = \left\lceil \frac{ta}{ts} \right\rceil = \frac{ta + ts - 1}{ts}
\]

åœ¨ä¸Šé¢è¿™ç»„æ•°æ®ä¸­ï¼š`minAssets = 2`ï¼ˆæ‰€ä»¥å­˜ 1 ä¼š revertï¼Œå­˜ 2 æ‰èƒ½ mint 1 ä¸ª share-weiï¼‰

---

## 9. â€œä¸ºä»€ä¹ˆå¾ªç¯ deposit(1)/redeem(1) æ²¡å¥—åˆ©ï¼Ÿâ€â€”â€”å…³é”®ç»“è®º

å½“ `ta == ts`ï¼ˆæˆ–éå¸¸æ¥è¿‘ï¼‰æ—¶ï¼š

- deposit(1) â†’ `shares = floor(1 * ts / ts) = 1`
- redeem(1) â†’ `assets = ceil(1 * ts / ts) = 1`

æ¥å›æŠµæ¶ˆï¼Œ**å‡€æ”¶ç›Šä¸º 0**ã€‚

è¦å‡ºç°â€œredeem å¤šç»™ +1â€ï¼Œå¿…é¡»è®©ï¼š

\[
\frac{shares \cdot ta}{ts} \text{ä¸æ˜¯æ•´æ•°}
\]

donation/æ”¶ç›Šå…¥è´¦/è¯¯è½¬ç­‰éƒ½ä¼šåˆ¶é€  `ta != ts` çš„éæ•´æ¯”çŠ¶æ€ï¼Œä»è€Œè®© ceil ç”Ÿæ•ˆã€‚

---

## 10. å¯å¤ç°å®éªŒï¼šä¸¤ç±»â€œæ›´åƒçœŸå®ä¸–ç•Œâ€çš„å‡€æ”¶ç›Šè·¯å¾„ï¼ˆæ¨èå†™è¿›ä»“åº“ï¼‰

### 10.1 æ–¹æ¡ˆ Aï¼ˆæ¨èï¼‰ï¼šå¤–éƒ¨ Rewarder æŒ‰ shares å‘å¥–åŠ± â†’ shares å¼‚å¸¸å¢é•¿å¯ç›´æ¥å˜ç°

ç°å®ä¸­å¸¸è§ï¼šæŒ–çŸ¿/è¡¥è´´/æ²»ç†æƒæŒ‰ shares æˆ– LP ä»½é¢å‘æ”¾ã€‚  
å½“ rounding bug èƒ½è®© shares å¼‚å¸¸è†¨èƒ€æ—¶ï¼Œ**å¥–åŠ±å±‚é¢å°±ä¼šå‡ºç°å‡€æ”¶ç›Š**ï¼ˆå¥–åŠ±æ˜¯çœŸå®èµ„äº§ï¼‰ã€‚

è¦ç‚¹ï¼ˆæ— éœ€ä»£ç ä¹Ÿèƒ½ç†è§£ï¼‰ï¼š

- Rewarder ç»´æŠ¤ `claimed[user]`
- `entitled = shareToken.balanceOf(user)`
- æ¯æ¬¡å‘ `entitled - claimed` çš„å¥–åŠ±  
- shares è¢«â€œåšå¤§â€ â†’ å¥–åŠ±è¢«â€œåšå¤§â€ â†’ å¯ç›´æ¥å˜ç°

### 10.2 æ–¹æ¡ˆ Bï¼šæŠŠæŸå¤±è½¬å«ç»™åæ¥è€…/å¤–éƒ¨åè®®ï¼ˆæŠµæŠ¼ä¼°å€¼ã€æ¸…ç®—ã€å¥–åŠ±åˆ†é…ï¼‰

Vault share price å¸¸è¢«å¤–éƒ¨åè®®å½“ä½œä»·æ ¼/æŠµæŠ¼ç‰©è¾“å…¥ã€‚  
å½“ donation + èˆå…¥è¾¹ç•Œå¯æ“çºµ share price æˆ–ä»½é¢åˆ†é…ï¼Œå°±å¯èƒ½åœ¨å¤–éƒ¨å€Ÿè´·/æ¸…ç®—/å¥–åŠ±ä¸­å‡ºç°çœŸå®ç›ˆåˆ©ã€‚

---

## 11. Fee èˆå…¥ï¼šä¸ºä»€ä¹ˆâ€œåˆ†æ‹†ç»•è´¹â€æœ‰æ—¶æˆç«‹ï¼Œæœ‰æ—¶æŠ¥é”™/ä¸æˆç«‹

ç»å…¸å feeï¼ˆbpsï¼‰ï¼š

\[
fee = \left\lfloor \frac{amount \cdot feeBps}{10000} \right\rfloor
\]

**åˆ†æ‹†ç»•è´¹æˆç«‹çš„å¿…è¦æ¡ä»¶**ï¼šåˆ†æ‹†åæ¯ç¬” fee å˜ä¸º 0ã€‚

å¯¹æ¯ç¬” `each`ï¼š

\[
\left\lfloor \frac{each \cdot feeBps}{10000} \right\rfloor = 0
\Rightarrow each \cdot feeBps < 10000
\Rightarrow each < \left\lceil \frac{10000}{feeBps} \right\rceil
\]

ä»¥ `feeBps = 30`ï¼ˆ0.3%ï¼‰ä¸ºä¾‹ï¼š

- ä¸´ç•Œé˜ˆå€¼ï¼š`ceil(10000/30)=334`
- `each=333` â†’ fee=0
- `each=334` â†’ fee=1

### 11.1 ä½ é‡åˆ°çš„æ–­è¨€å¤±è´¥ï¼ˆfeeSplit == feeSingleï¼‰
ä½ æŠŠå¤§é‡‘é¢åˆ†æˆå¾ˆå¤šä»½ï¼Œä½†æ¯ä»½ä»è¶³å¤Ÿå¤§ï¼Œå¯¼è‡´æ¯ç¬” fee ä¸ä¸º 0 â†’ æ€» fee æ°å¥½ç­‰äºå•ç¬” feeã€‚  
æ‰€ä»¥æ–­è¨€ `feeSplit < feeSingle` ä¼šå¤±è´¥ï¼ˆä¸¤è€…ç›¸ç­‰ï¼‰ã€‚

### 11.2 ä½ é‡åˆ°çš„ OutOfGas
æŠŠ `amount` æ¬¡å¾ªç¯ï¼ˆç”šè‡³æ›´å¤šï¼‰æ¯æ¬¡è°ƒç”¨ä¸€æ¬¡åˆçº¦ï¼Œä¼šéå¸¸è€— gasã€‚  
è§£å†³æ–¹å¼ï¼šé€‰ä¸€ä¸ª**å°å¾ªç¯æ¬¡æ•°**ï¼ˆå¦‚ 1000ï¼‰ï¼Œä¸”ç¡®ä¿æ¯ç¬” `each` < é˜ˆå€¼ï¼ˆ333ï¼‰ï¼Œä¿è¯æ¯ç¬” fee=0ï¼ŒåŒæ—¶å•ç¬” fee>0ã€‚

---

## 12. å®¡è®¡è§†è§’ Checklistï¼ˆä»Šæ—¥é‡ç‚¹ï¼‰

### 12.1 Vault / shares ç›¸å…³
- [ ] `totalAssets()` çš„æ¥æºæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦ç›´æ¥ç”¨ `asset.balanceOf(this)`ï¼ˆä¼šè¢« donation å½±å“ï¼‰
- [ ] åˆå§‹åŒ–åˆ†æ”¯ï¼šæ˜¯å¦ç”¨ `ts==0 || ta==0`ï¼ˆé˜² ts==0,ta>0 çš„ donation é¦–å­˜ DoSï¼‰
- [ ] deposit/redeem/withdraw/mint çš„ rounding æ˜¯å¦ä¸€è‡´ï¼Ÿæ˜¯å¦èƒ½å½¢æˆâ€œæ­£æ”¶ç›Šç¯è·¯â€
- [ ] æ˜¯å¦å­˜åœ¨ `shares==0` çš„ dust é—®é¢˜ï¼Ÿæœ‰æ—  `minDeposit/minShares`ã€ä»¥åŠ UX/DoS é£é™©
- [ ] æ˜¯å¦ä½¿ç”¨ `mulDiv`ï¼ˆå…¨ç²¾åº¦ä¹˜é™¤ï¼‰å¹¶æ˜ç¡® roundingï¼ˆé¿å…æº¢å‡º/ç²¾åº¦æŸå¤±ï¼‰
- [ ] æ˜¯å¦å¼•å…¥ **virtual shares/assets**ï¼ˆå¸¸è§é˜² donation/ç©ºæ± æ“çºµï¼‰
- [ ] é¡ºåºå®‰å…¨ï¼šå»ºè®®å…ˆ `transferFrom` æˆåŠŸï¼Œå† `_mint`ï¼ˆå¹¶å°½é‡ç”¨ SafeERC20ï¼‰

### 12.2 Fee èˆå…¥ç›¸å…³
- [ ] fee æ˜¯å¦ä½¿ç”¨ `floor`ï¼Ÿæ˜¯å¦å…è®¸ `fee=0` çš„å°é¢è·¯å¾„
- [ ] æ˜¯å¦èƒ½é€šè¿‡â€œæ‹†åˆ† many small txâ€å°‘ä»˜è´¹/å…æ‰‹ç»­è´¹
- [ ] æ˜¯å¦æœ‰ `minFee`ã€æˆ–ç”¨ `ceil`ã€æˆ–ç´¯ç§¯ remainderï¼ˆæŠŠä½™æ•°ç´¯åˆ°ä¸‹ä¸€ç¬”ï¼‰
- [ ] fee æ˜¯å¦å‚ä¸å¤–éƒ¨ä¼°å€¼/æ¸…ç®—/å¥–åŠ±åˆ†é…ï¼ˆä¼šæ”¾å¤§å½±å“ï¼‰

---

## 13. ä»Šæ—¥ Q&Aï¼ˆä½ æé—®çš„ç‚¹æ±‡æ€»æˆå¯å¤ä¹ å¡ç‰‡ï¼‰

### Q1ï¼š`address(this)` æ˜¯ä¸æ˜¯ `asset`ï¼Ÿ
ä¸æ˜¯ã€‚`address(this)` æ˜¯å½“å‰åˆçº¦ï¼ˆVaultï¼‰åœ°å€ï¼›`asset` æ˜¯åº•å±‚ ERC20 åˆçº¦åœ°å€ã€‚

### Q2ï¼šä¸ºä»€ä¹ˆè¦é€šè¿‡ USDC åˆçº¦è½¬è´¦ï¼Ÿä¸èƒ½ Alice ç›´æ¥è½¬ç»™ Vault å—ï¼Ÿ
ERC20 ä½™é¢åœ¨ ERC20 åˆçº¦è´¦æœ¬é‡Œï¼Œå¿…é¡»è°ƒç”¨ ERC20 çš„ `transfer/transferFrom` æ‰èƒ½æ”¹è´¦æœ¬ï¼›Alice â€œç›´æ¥è½¬â€ä¹Ÿæ˜¯ Alice è°ƒç”¨ USDC åˆçº¦çš„ `transfer(vault, amount)`ã€‚

### Q3ï¼šä¸ºä»€ä¹ˆ Rewarder ç”¨ `IERC20(address(vault))`ï¼Œç›´æ¥ç”¨ `address(vault)` ä¸è¡Œå—ï¼Ÿ
ä¸è¡Œã€‚Rewarder çš„æ„é€ å‡½æ•°å‚æ•°ç±»å‹æ˜¯ `IERC20`ï¼Œ`address` ä¸èƒ½è‡ªåŠ¨å½“æˆæ¥å£ä½¿ç”¨ï¼›éœ€è¦æ˜¾å¼è½¬æ¢æ‰èƒ½è°ƒç”¨ `balanceOf/transfer`ã€‚

### Q4ï¼šRewarder å‘å¥–åŠ±ä¸ºä»€ä¹ˆç”¨ `transfer` è€Œä¸æ˜¯ `transferFrom`ï¼Ÿ
å¥–åŠ±ä»£å¸é¢„å­˜åˆ° Rewarder åï¼Œå‘å¥–æ˜¯â€œåˆçº¦æŠŠè‡ªå·±ä½™é¢è½¬ç»™ç”¨æˆ·â€â†’ ç”¨ `transfer`ã€‚`transferFrom` ç”¨äºä»ç¬¬ä¸‰æ–¹/ç”¨æˆ·æ‹‰å–èµ„é‡‘ï¼ˆéœ€è¦ approveï¼‰ã€‚

### Q5ï¼š`reward.mint(address(this), ...)` ä¸ºä»€ä¹ˆèƒ½ç»™æµ‹è¯•åˆçº¦é“¸å¸å¹¶å†è½¬ç»™ rewarderï¼Ÿ
æµ‹è¯•ç”¨ `MockERC20` å…è®¸ mintï¼ˆæˆ–æµ‹è¯•åˆçº¦æœ‰ minter æƒé™ï¼‰ã€‚`address(this)` æ˜¯æµ‹è¯•åˆçº¦åœ°å€ï¼Œå®ƒä¹Ÿæ˜¯æ™®é€šåœ°å€ï¼Œå½“ç„¶èƒ½æŒå¸å¹¶è°ƒç”¨ `transfer` è½¬å‡ºã€‚

### Q6ï¼šä¸ºä»€ä¹ˆ donateï¼ˆæˆ–ç­‰ä»· donationï¼‰å¯¹å¤ç°é‡è¦ï¼Ÿç›´æ¥ deposit ä¸è¡Œå—ï¼Ÿ
deposit é€šå¸¸åŒæ—¶å¢åŠ  `ta` ä¸ `ts`ï¼Œä¿æŒæ•´æ¯”ï¼Œredeem çš„ ceil ä¸ä¼šäº§ç”Ÿâ€œ+1 çº¢åˆ©â€ã€‚donation/æ”¶ç›Š/è¯¯è½¬ä½¿ `ta != ts`ï¼Œæ‰ä¼šè§¦å‘èˆå…¥ä¸ä¸€è‡´å¸¦æ¥çš„å¯åˆ©ç”¨è¾¹ç•Œã€‚

---

æ–°å¹´å¿«ä¹ ğŸ‰  
ä¹Ÿç¥ä½ è¿™å¥—â€œæ¼æ´å¤ç° + å®¡è®¡è§†è§’ + å¯è·‘ä»“åº“â€è¶Šåšè¶Šåƒä½œå“é›†ï¼
